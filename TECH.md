# Technical Documentation (TECH)## 红利低波指数股息率分析平台 - 技术文档---## 1. 技术架构### 1.1 整体架构```┌─────────────────────────────────────────────┐│          GitHub Pages (Hosting)             │└─────────────────────────────────────────────┘                      │                      ▼┌─────────────────────────────────────────────┐│            index.html (Entry)               ││  ┌───────────────────────────────────────┐  ││  │         HTML Structure               │  ││  │  - Header (Title & Description)      │  ││  │  - Data Source Configuration         │  ││  │  - Chart Section (Canvas)            │  ││  │  - Data Table                        │  ││  └───────────────────────────────────────┘  ││                                             ││  ┌───────────────────────────────────────┐  ││  │         CSS Styling                  │  ││  │  - Responsive Design                 │  ││  │  - Gradient UI                       │  ││  │  - Mobile Adaptation                 │  ││  └───────────────────────────────────────┘  ││                                             ││  ┌───────────────────────────────────────┐  ││  │      JavaScript Logic                │  ││  │  - Data Fetching (Fetch API)        │  ││  │  - CSV/JSON Parsing                  │  ││  │  - Chart Rendering (Chart.js)       │  ││  │  - Error Handling                    │  ││  │  - Demo Data Generation              │  ││  └───────────────────────────────────────┘  │└─────────────────────────────────────────────┘                      │                      ▼┌─────────────────────────────────────────────┐│       Chart.js Library (CDN)                ││       https://cdn.jsdelivr.net/             │└─────────────────────────────────────────────┘```### 1.2 技术栈详情| 层级 | 技术 | 版本 | 用途 ||------|------|------|------|| 前端框架 | Pure HTML5 | - | 页面结构 || 样式 | CSS3 | - | UI设计、响应式布局 || 脚本 | JavaScript | ES6+ | 业务逻辑、数据处理 || 图表库 | Chart.js | 4.4.0 | 数据可视化 || 托管平台 | GitHub Pages | - | 静态网站部署 || 版本控制 | Git | - | 代码管理 |---## 2. 核心模块实现### 2.1 数据获取模块**功能**：从用户提供的URL获取数据**实现细节**：```javascriptasync function loadData() {    const url = document.getElementById('dataUrl').value.trim();        if (!url) {        showStatus('请输入数据源URL', 'error');        return;    }        setLoading(true);        try {        const response = await fetch(url);                if (!response.ok) {            throw new Error(`HTTP错误: ${response.status}`);        }                const contentType = response.headers.get('content-type');        let data;                if (contentType && contentType.includes('application/json')) {            data = await response.json();        } else {            const text = await response.text();            data = parseCSV(text);        }                // 处理数据...    } catch (error) {        // 错误处理...    } finally {        setLoading(false);    }}```**技术要点**：- 使用 `fetch API` 进行异步数据获取- 自动检测内容类型（JSON/CSV）- 完善的错误处理机制- CORS 错误提示与处理建议### 2.2 数据解析模块**CSV解析**：```javascriptfunction parseCSV(text) {    const lines = text.trim().split('\n');    const headers = lines[0].toLowerCase().split(',').map(h => h.trim());    const dateIndex = headers.findIndex(h => h.includes('date') || h === '日期');    const yieldIndex = headers.findIndex(h => h.includes('yield') || h.includes('股息率'));        if (dateIndex === -1 || yieldIndex === -1) {        throw new Error('CSV格式不正确：需要包含 date 和 yield 列');    }        const dates = [];    const yields = [];        for (let i = 1; i < lines.length; i++) {        const values = lines[i].split(',').map(v => v.trim());        if (values.length > 1) {            dates.push(values[dateIndex]);            yields.push(parseFloat(values[yieldIndex]));        }    }        return { dates, yields };}```**JSON解析**：- 直接使用 `response.json()` 解析- 验证数据格式（必须包含 `dates` 和 `yields` 字段）### 2.3 图表渲染模块**Chart.js 配置**：```javascriptfunction renderChart(dates, yields) {    const ctx = document.getElementById('yieldChart').getContext('2d');        if (chart) {        chart.destroy();    }        chart = new Chart(ctx, {        type: 'line',        data: {            labels: dates,            datasets: [{                label: 'TTM股息率 (%)',                data: yields,                borderColor: '#667eea',                backgroundColor: 'rgba(102, 126, 234, 0.1)',                borderWidth: 3,                fill: true,                tension: 0.4,                pointRadius: 5,                pointHoverRadius: 7,                pointBackgroundColor: '#667eea',                pointBorderColor: '#fff',                pointBorderWidth: 2            }]        },        options: {            responsive: true,            maintainAspectRatio: false,            // 更多配置...        }    });}```**技术要点**：- 响应式图表（`responsive: true`）- 自定义颜色和样式- 平滑曲线（`tension: 0.4`）- 交互式数据点- 自定义工具提示### 2.4 表格渲染模块**动态表格生成**：```javascriptfunction renderTable(dates, yields) {    const tbody = document.getElementById('tableBody');    tbody.innerHTML = '';        for (let i = 0; i < dates.length; i++) {        const row = tbody.insertRow();        const change = i > 0 ? yields[i] - yields[i-1] : 0;        const changeSymbol = change > 0 ? '↑' : change < 0 ? '↓' : '→';        const changeColor = change > 0 ? 'green' : change < 0 ? 'red' : 'gray';                row.innerHTML = `            <td>${dates[i]}</td>            <td><strong>${yields[i].toFixed(2)}%</strong></td>            <td style="color: ${changeColor}">                ${changeSymbol} ${Math.abs(change).toFixed(2)}%            </td>        `;    }}```**功能特点**：- 计算日涨跌幅- 颜色编码（涨：绿色，跌：红色）- 涨跌符号（↑↓→）### 2.5 演示数据生成模块**模拟数据生成**：```javascriptfunction loadDemoData() {    const today = new Date();    const dates = [];    const yields = [];        for (let i = 14; i >= 0; i--) {        const date = new Date(today);        date.setDate(date.getDate() - i);        dates.push(date.toISOString().split('T')[0]);                // 生成模拟数据：基础值3.5% ± 随机波动        const baseYield = 3.5;        const randomVariation = (Math.random() - 0.5) * 0.3;        yields.push(baseYield + randomVariation);    }        renderChart(dates, yields);    renderTable(dates, yields);        document.getElementById('chartSection').style.display = 'block';    showStatus('已加载演示数据（模拟）', 'info');}```**用途**：- 页面首次加载时展示- 数据获取失败时的降级方案- 功能演示和测试---## 3. 响应式设计实现### 3.1 移动端适配**CSS媒体查询**：```css@media (max-width: 768px) {    body {        padding: 10px;    }        header h1 {        font-size: 1.5rem;    }        .content {        padding: 20px;    }        .chart-container {        height: 300px;    }        .input-group {        flex-direction: column;    }        .input-group button {        width: 100%;    }        th, td {        padding: 8px;        font-size: 13px;    }}```**适配策略**：- **768px以下**：切换为移动端布局- **按钮**：全宽显示- **图表**：降低高度（400px → 300px）- **表格**：减小字体和内边距- **输入框**：垂直排列### 3.2 PC端优化**最大宽度限制**：```css.container {    max-width: 1200px;    margin: 0 auto;}```**大屏幕体验**：- 居中显示，最大宽度1200px- 充足的内边距和间距- 大号字体和图表---## 4. 性能优化### 4.1 CDN加速**Chart.js CDN**：```html<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>```**优势**：- 快速加载（jsDelivr全球CDN）- 缓存优化- 无需本地托管### 4.2 代码优化- **图表复用**：销毁旧图表后创建新图表，避免内存泄漏- **事件委托**：减少事件监听器数量- **异步加载**：使用 `async/await` 避免阻塞- **懒加载**：图表和表格仅在有数据时显示### 4.3 数据优化- **数据切片**：只取最近15天数据（`slice(-15)`）- **精度控制**：保留两位小数（`toFixed(2)`）---## 5. 错误处理机制### 5.1 CORS错误处理```javascriptif (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {    errorMsg += '\n\n可能的原因：\n1. 数据源不支持CORS（跨域请求）\n2. URL地址无效或网络连接问题\n3. 数据源服务器暂时不可用\n\n建议：使用支持CORS的公共数据服务（如GitHub Gist、jsDelivr等）';}```### 5.2 数据格式验证```javascriptif (!data.dates || !data.yields || data.dates.length === 0) {    throw new Error('数据格式不正确或数据为空');}```### 5.3 用户友好提示- **成功**：绿色背景提示- **错误**：红色背景提示- **信息**：蓝色背景提示- **自动消失**：5秒后自动隐藏---## 6. 浏览器兼容性### 6.1 支持的浏览器| 浏览器 | 最低版本 | 说明 ||--------|----------|------|| Chrome | 90+ | 完全支持 || Firefox | 88+ | 完全支持 || Safari | 14+ | 完全支持 || Edge | 90+ | 完全支持 || iOS Safari | 14+ | 完全支持 || Chrome Mobile | 90+ | 完全支持 |### 6.2 使用的现代特性- `async/await` (ES2017)- `fetch API` (ES6)- `const/let` (ES6)- Arrow functions (ES6)- Template literals (ES6)- CSS Grid/Flexbox- CSS媒体查询---## 7. 部署配置### 7.1 GitHub Pages设置```yaml# GitHub Pages配置Source: Deploy from a branchBranch: mainDirectory: / (root)```### 7.2 访问地址- **仓库地址**：https://github.com/wdsdwsh1135-del/dividend-low-volatility-analysis- **GitHub Pages地址**：https://wdsdwsh1135-del.github.io/dividend-low-volatility-analysis/### 7.3 自动部署- **触发条件**：推送到 `main` 分支- **部署时间**：约1-2分钟- **状态查看**：仓库 → Actions 或 Deployments---## 8. 数据接口规范### 8.1 JSON格式```json{  "dates": [    "2024-01-01",    "2024-01-02",    "2024-01-03"  ],  "yields": [    3.50,    3.52,    3.48  ]}```**要求**：- `dates`：日期数组（ISO 8601格式：YYYY-MM-DD）- `yields`：股息率数组（数字类型，单位：%）- 数组长度必须一致### 8.2 CSV格式```csvdate,yield2024-01-01,3.502024-01-02,3.522024-01-03,3.48```**要求**：- 第一行：列名（必须包含 `date` 和 `yield`）- 后续行：数据行- 分隔符：逗号（`,`）### 8.3 CORS要求数据源必须：- 支持 CORS（允许跨域请求）- 或使用代理服务- 或部署在同域名下**推荐的公共数据服务**：- GitHub Gist (https://gist.github.com/)- jsDelivr CDN (https://cdn.jsdelivr.net/)- Pastebin (https://pastebin.com/)---## 9. 安全性考虑### 9.1 内容安全策略 (CSP)当前未实施CSP，未来可添加：```html<meta http-equiv="Content-Security-Policy"       content="default-src 'self';                script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;                style-src 'self' 'unsafe-inline';">```### 9.2 XSS防护- 使用 `textContent` 而非 `innerHTML`（需要时）- 验证和清理用户输入的URL### 9.3 数据隐私- 不存储用户数据- 不使用Cookie或本地存储- 所有数据处理在客户端完成---## 10. 未来技术规划### 10.1 短期计划- [ ] 添加数据缓存（LocalStorage）- [ ] 支持更多图表类型（柱状图、饼图）- [ ] 添加数据导出功能- [ ] 支持暗黑模式### 10.2 长期计划- [ ] PWA支持（离线访问）- [ ] 多语言支持（i18n）- [ ] 更多技术指标分析- [ ] WebSocket实时数据更新---## 11. 开发与调试### 11.1 本地开发```bash# 克隆仓库git clone https://github.com/wdsdwsh1135-del/dividend-low-volatility-analysis.git# 进入目录cd dividend-low-volatility-analysis# 使用任意静态服务器运行# 例如：Pythonpython -m http.server 8000# 或使用 VS Code Live Server 插件```### 11.2 调试技巧- **Chrome DevTools**：查看网络请求和控制台日志- **响应式设计模式**：测试移动端显示- **Network面板**：检查CORS错误- **Console面板**：查看错误信息---## 12. 常见问题 (FAQ)### Q1: CORS错误如何解决？**A**: 使用支持CORS的数据源，或使用CORS代理服务。### Q2: 数据不显示怎么办？**A**: 检查数据格式是否正确，查看浏览器控制台错误信息。### Q3: 移动端显示异常？**A**: 清除浏览器缓存，确保使用最新版本的代码。### Q4: 如何更新数据？**A**: 输入新的数据URL，点击"加载数据"按钮。---**文档版本**：v1.0  **最后更新**：2026-02-18  **维护者**：wdsdwsh1135-del
